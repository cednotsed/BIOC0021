require(ape)
tree <- nj(cm)
getwd()
require(seqinr)
require(seqinr)
read.fasta("data/anellovirus_n1147_201020.fasta")
fasta <- read.fasta("data/anellovirus_n1147_201020.fasta")
summary(fasta)
View(summary(fasta))
summary(fasta[1])
require(ape)
fasta <- read.dna("data/anellovirus_n1147_201020.fasta")
fasta <- read.FASTA("data/anellovirus_n1147_201020.fasta")
fasta
base.freq(fasta)
base.freq(x = fasta)
seq(fata)
seq(fasta)
fasta <- read.fasta("data/anellovirus_n1147_201020.fasta")
fasta
fasta <- read.fasta("data/anellovirus_n1147_201020.fasta", as.string = T)
fasta[1]
seq(fasta[1])
str(fasta[1])
fasta[1]
fasta[1]$NC_040531.1
fasta[[1]
fasta[[1]]
name(fasta)[1]
getSequence(fasta)[1]
getSequence(fasta[1], as.string = T)
for (seq in fasta){
s <- getSequence(seq, as.string = T)
print(base.freq(s))
}
fasta <- read.FASTA("data/anellovirus_n1147_201020.fasta")
fasta
seq(fasta)
packages <- c("data.table","ape","phangorn","ggplot2","seqinr","ggtree","RColorBrewer")
invisible(lapply(packages, function(x) suppressPackageStartupMessages(require(x, character.only=T))))
cm <- fread("data/mash_matrix_k13.tsv")
cm[1:5, 1:5]
cm <- data.matrix(cm)
cm <- read.csv("data/mash_matrix_k13.tsv", sep = "\t",
header = T,
row.names = 1,
stringsAsFactors = F)
cm <- data.matrix(cm)
require(ape)
tree <- nj(cm)
# Get tree metadata
meta <- read.csv("data/anellovirus_n1147_201020.csv", check.names = F, stringsAsFactors = F)
meta
# Get tree metadata
meta <- fread("data/anellovirus_n1147_201020.csv")
meta
meta %>%
View()
meta %>%
select(Genus)
meta %>%
select(Genus) %>%
mutate(Genus = replace(Genus, "", "Unassigned"))
meta %>%
mutate(Genus = replace(Genus, "", "Unassigned"))
meta %>%
mutate(Genus = replace(Genus, Genus == "", "Unassigned"))
meta %>%
mutate(Genus = replace(Genus, Genus == "", "Unassigned")) %>%
View()
tree$tip.label
meta$Accession
tree$tip.label
meta$Accession
# Drop tips which cannot be matched to protein accessions file
tree$tip.label
# Drop tips which cannot be matched to protein accessions file
protein_names <- colsplit(tree$tip.label, '\\.', c("desired", NA))$desired
separate(tree$tip.label, '\\.', c("desired", NA))
tree$tip.label
strsplit(tree$tip.label, "\\.")
strsplit(tree$tip.label, "\\.")[1]
strsplit(tree$tip.label, "\\.")
unlist(strsplit(tree$tip.label, "\\."))
unlist(strsplit(tree$tip.label, "\\."))[1]
unlist(strsplit(tree$tip.label, "\\."))[2]
packages <- c("data.table","ape","phangorn","ggplot2","seqinr","ggtree","RColorBrewer", "reshape2")
invisible(lapply(packages, function(x) suppressPackageStartupMessages(require(x, character.only=T))))
colsplit(tree$tip.label, '\\.', c("desired", NA))
colsplit(tree$tip.label, '\\.', c("desired", NA))$desired
# Drop tips which cannot be matched to protein accessions file
tree$tip.label <- colsplit(tree$tip.label, '\\.', c("desired", NA))$desired
match(tree$tip.label, meta$Accession)
length(tree$tip.label)
length(meta$Accession)
tree <- drop.tip(tree, tree$tip.label[is.na(match(tree$tip.label, meta$Accession))])
tree$tip.label
length(tree$tip.label)
# Match tips to metadata
meta.match <- meta[match(tree$tip.label, meta$Accession), ]
dd <- data.frame(Accession=meta.match$Accession,
Genus=meta.match$Genus)
rownames(dd) <- tree$tip.label
# Plot tree
p <- ggtree(tree)
tree
# Plot tree
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
theme(legend.title = element_text(size = 30),
legend.text = element_text(size = 30)) +
guides(colour = guide_legend(override.aes = list(size = 12)))
p
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
theme(legend.title = element_text(size = 30),
legend.text = element_text(size = 30)) +
guides(colour = guide_legend(override.aes = list(size = 12))) +
scale_color_manual(values=c25[1:length(unique(dd$Genus))])
p
c25 <- c(
"dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"gray70", "khaki2",
"maroon", "orchid1", "deeppink1", "blue1", "steelblue4",
"darkturquoise", "green1", "yellow4", "yellow3",
"darkorange4", "brown"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
theme(legend.title = element_text(size = 30),
legend.text = element_text(size = 30)) +
guides(colour = guide_legend(override.aes = list(size = 12))) +
scale_color_manual(values=c25[1:length(unique(dd$Genus))])
p
getwd()
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300)
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300, width = 5, height = 10)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
guides(colour = guide_legend(override.aes = list(size = 12))) +
scale_color_manual(values=c25[1:length(unique(dd$Genus))])
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))])
p
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300, width = 5, height = 10)
p
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300)
meta <- fread("data/anellovirus_n1147_201020.csv")
meta <- meta[, c("Accession", "bins", "Host Genus", "Genus", "Host Order")]
meta <- meta %>%
mutate(Genus = replace(Genus, Genus == "", "Unassigned"))
# Drop tips which cannot be matched to protein accessions file
tree$tip.label <- colsplit(tree$tip.label, '\\.', c("desired", NA))$desired
tree <- drop.tip(tree, tree$tip.label[is.na(match(tree$tip.label, meta$Accession))])
# Match tips to metadata
meta.match <- meta[match(tree$tip.label, meta$Accession), ]
# Make dataframe for tree annotations
dd <- data.frame(Accession=meta.match$Accession,
Genus=meta.match$Genus)
rownames(dd) <- tree$tip.label
# Plot tree
c25 <- c(
"dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"gray70", "khaki2",
"maroon", "orchid1", "deeppink1", "blue1", "steelblue4",
"darkturquoise", "green1", "yellow4", "yellow3",
"darkorange4", "brown"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[2: 2 +length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1: length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
c25 <- rev(c25)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
c25 <- rev(c25)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
dd <- data.frame(Accession=meta.match$Accession,
Genus=meta.match$Genus)
rownames(dd) <- tree$tip.label
# Plot tree
c25 <- c(
"dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"gray70", "khaki2",
"maroon", "orchid1", "deeppink1", "blue1", "steelblue4",
"darkturquoise", "green1", "yellow4", "yellow3",
"darkorange4", "brown"
)
c25 <- rev(c25)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .6) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
c25 <- rev(c25)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
c25 <- c(
"dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"gray70", "khaki2",
"maroon", "orchid1", "deeppink1", "blue1", "steelblue4",
"darkturquoise", "green1", "yellow4", "yellow3",
"darkorange4", "brown"
)
c25 <- rev(c25)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=c25[1:length(unique(dd$Genus))]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300)
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300, width = 5, height = 8)
pal <- c25[1:length(unique(dd$Genus))
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
pal <- c25[1:length(unique(dd$Genus))]
pal
length(unique(dd$Genus)  )
# Plot tree
c25 <- c(
"dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", "gray70"
"maroon",
)
# Plot tree
c25 <- c(
"dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", "gray70",
"maroon",
)
# Plot tree
c25 <- c("dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", "gray70",
"maroon"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=]) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=pal) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
# Plot tree
pal <- c("dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", "gray70",
"maroon"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=pal) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
# Plot tree
pal <- c("dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"black", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", "white",
"maroon"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=pal) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
# Plot tree
pal <- c("dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"steelblue", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", "black",
"maroon"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=pal) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
pal <- c("dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"steelblue", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", NA,
"maroon"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=pal) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300, width = 5, height = 8)
pal <- c("dodgerblue2", "#E31A1C", # red
"green4",
"#6A3D9A", # purple
"#FF7F00", # orange
"steelblue", "gold1",
"skyblue2", "#FB9A99", # lt pink
"palegreen2",
"#CAB2D6", # lt purple
"#FDBF6F", # lt orange
"khaki2", NA,
"maroon"
)
p <- ggtree(tree)
p <- p %<+% dd +
geom_tippoint(aes(hjust = 0.5,
color = Genus), alpha = .8) +
labs(color = "Viral Genus")  +
scale_color_manual(values=pal) +
theme(legend.title = element_text(size = 10),
legend.text = element_text(size = 10))
p
ggsave("../results/anellovirus_mash_k13_NJ.png", dpi = 300, width = 5, height = 8)
